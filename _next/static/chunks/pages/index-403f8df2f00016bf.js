(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[405],{8312:function(e,t,s){(window.__NEXT_P=window.__NEXT_P||[]).push(["/",function(){return s(9574)}])},9574:function(e,t,s){"use strict";s.r(t),s.d(t,{default:function(){return I}});var a,r,n=s(5893),i=s(7294),l=s(5029),o=s(1884),c=s(9477),h=s(2051),d=s(8243);let p=e=>{let{wires:t,points:s}=e,[a]=(0,i.useState)(m(t,s)),[r]=(0,i.useState)(u(t,s));return(0,n.jsxs)(n.Fragment,{children:[t.map((e,t)=>Array.from(Array(e.numParallel)).map((t,s)=>(0,n.jsx)(d.x,{points:new c.EllipseCurve(e.ax,e.ay,e.xRadius,e.yRadius,Math.PI+Math.PI/8,0-Math.PI/8,!1,0).getPoints(50).map(t=>new c.Vector3(t.x,t.y,0===s?e.zTranslate:1===s?e.spacing%2==0?e.zTranslate+e.spacing:e.zTranslate+e.spacing/2:e.zTranslate+2*e.spacing)),color:"blue",lineWidth:1,rotation:new c.Euler(0,e.rotation,0)},e.ax+e.ay+s))),t.map((e,t)=>{let s=a.get(t);return s?(0,n.jsxs)("group",{children:[(0,n.jsxs)("mesh",{position:[s[0].x,s[0].y-8,s[0].z],rotation:new c.Euler(0,e.rotation+Math.PI/2,0),children:[(0,n.jsx)("boxGeometry",{args:[1===e.numParallel?10:2===e.numParallel?1.5*e.spacing:3*e.spacing,3,3]}),(0,n.jsx)("meshStandardMaterial",{color:"gray"})]}),(0,n.jsxs)("mesh",{position:[s[1].x,s[1].y-8,s[1].z],rotation:new c.Euler(0,e.rotation+Math.PI/2,0),children:[(0,n.jsx)("boxGeometry",{args:[1===e.numParallel?10:2===e.numParallel?1.5*e.spacing:3*e.spacing,3,3]}),(0,n.jsx)("meshStandardMaterial",{color:"gray"})]}),(0,n.jsxs)("mesh",{position:[s[0].x,s[0].y-150,s[0].z],children:[(0,n.jsx)("boxGeometry",{args:[3,300,3]}),(0,n.jsx)("meshStandardMaterial",{color:"gray"})]}),(0,n.jsxs)("mesh",{position:[s[1].x,s[1].y-150,s[1].z],children:[(0,n.jsx)("boxGeometry",{args:[3,300,3]}),(0,n.jsx)("meshStandardMaterial",{color:"gray"})]}),Array.from(Array(e.numParallel)).map((e,s)=>{let a=r.get(JSON.stringify([t,s]));return a?(0,n.jsxs)("group",{children:[(0,n.jsxs)("mesh",{position:[a[0].x,a[0].y-4,a[0].z],children:[(0,n.jsx)("cylinderGeometry",{args:[.5,1,5]}),(0,n.jsx)("meshStandardMaterial",{color:new c.Color(3355443)})]}),(0,n.jsxs)("mesh",{position:[a[1].x,a[1].y-4,a[1].z],children:[(0,n.jsx)("cylinderGeometry",{args:[.5,1,5]}),(0,n.jsx)("meshStandardMaterial",{color:new c.Color(3355443)})]})]},JSON.stringify([t,s])):(0,n.jsx)(n.Fragment,{})})]},t):(0,n.jsx)(n.Fragment,{})})]})},m=(e,t)=>{let s=new Map,a=0,r=0;for(let n=0;n<e.length;n++){r=(a=0===n?0:r+1)+50*e[n].numParallel+(e[n].numParallel-1);let i=t[a],l=t[r];if(0===e[n].rotation){let o=(i.z+l.z)/2,h=new c.Vector3(i.x,i.y,o),d=new c.Vector3(l.x,l.y,o);s.set(n,[h,d])}else{let p=(i.x+l.x)/2,m=new c.Vector3(p,i.y,i.z),u=new c.Vector3(p,l.y,l.z);s.set(n,[m,u])}}return s},u=(e,t)=>{let s=new Map,a=0,r=0;for(let n=0;n<e.length;n++)for(let i=0;i<e[n].numParallel;i++)r=(a=0===n&&0===i?0:r+1)+50,s.set(JSON.stringify([n,i]),[new c.Vector3(t[a].x,t[a].y,t[a].z),new c.Vector3(t[r].x,t[r].y,t[r].z)]);return s};(a=r||(r={}))[a.FLYING=0]="FLYING",a[a.PERCHED=1]="PERCHED";var x=s(8626);class g{add(e){this.x+=e.x,this.y+=e.y,this.z+=e.z}diff(e){return new g({x:this.x-e.x,y:this.y-e.y,z:this.z-e.z})}sum(e){return new g({x:this.x+e.x,y:this.y+e.y,z:this.z+e.z})}div(e){return new g({x:this.x/e,y:this.y/e,z:this.z/e})}prod(e){return new g({x:this.x*e,y:this.y*e,z:this.z*e})}addX(e){this.x+=e}addY(e){this.y+=e}addZ(e){this.z+=e}setX(e){this.x=e}setY(e){this.y=e}setZ(e){this.z=e}constructor(e){this.x=e.x,this.y=e.y,this.z=e.z,this.w=e.w}}class y{incremXYZ(e,t,s){this.pos.add(new g({x:e,y:t,z:s}))}incremVXYZ(e){this.vel.add(e)}incremVX(e){this.vel.addX(e)}incremVY(e){this.vel.addY(e)}incremVZ(e){this.vel.addZ(e)}setVX(e){this.vel.setX(e)}setVY(e){this.vel.setY(e)}setVZ(e){this.vel.setZ(e)}incremX(e){this.pos.addX(e)}incremY(e){this.pos.addY(e)}incremZ(e){this.pos.addZ(e)}setXYZ(e,t,s){this.pos=new g({x:e,y:t,z:s})}setVXYZ(e,t,s){this.vel=new g({x:e,y:t,z:s})}move(e){this.pos.add(new g({x:this.vel.x*e*.08,y:this.vel.y*e*.08,z:this.vel.z*e*.08}))}setWillPerch(e){this.perchProb||(this.perchProb=e)}unsetWillPerch(){this.perchProb=void 0}willPerch(){return!!this.perchProb&&this.perchProb<8}setBias(e){this.bias=e}setAction(e){this.action=e}setPerchedAt(e){this.perchedAt=e}getSpeed(){return(this.vel.x**2+this.vel.y**2+this.vel.z**2)**.5}getGrid(e){return[(0,h.Z)(this.pos.x/e)*e,(0,h.Z)(this.pos.y/e)*e,(0,h.Z)(this.pos.z/e)*e]}getNeighbors(e){let t,s,a;let r=this.getGrid(e),n=this.pos.x,i=this.pos.y,l=this.pos.z,o=r[0]+e/2,c=r[1]+e/2,h=r[2]+e/2,d=[];return t=n<o?r[0]-e:r[0]+e,s=i<c?r[1]-e:r[1]+e,a=l<h?r[2]-e:r[2]+e,d.push(JSON.stringify([r[0],s,r[2]])),d.push(JSON.stringify([r[0],s,a])),d.push(JSON.stringify([r[0],r[1],r[2]])),d.push(JSON.stringify([r[0],r[1],a])),d.push(JSON.stringify([t,s,r[2]])),d.push(JSON.stringify([t,s,a])),d.push(JSON.stringify([t,r[1],r[2]])),d.push(JSON.stringify([t,r[1],a])),d}constructor({pos:e,vel:t,bias:s,id:a,action:r,perchDur:n,perchedAt:i,perchLoc:l,flapOffset:o}){this.pos=e,this.vel=t,this.bias=s,this.id=a,this.action=r,this.perchDur=n,this.perchedAt=i,this.perchLoc=l,this.flapOffset=o}}let f=e=>{let{border:t,consts:s,boxOpacity:a,numberBirds:l,allPerching:d,setAllPerching:m}=e,{camera:u,gl:f,scene:V}=(0,o.z)(),b=(0,i.useRef)(null);V.add(u),b.current&&u.add(b.current);let j=(0,i.useRef)(null),M=Date.now(),[P,E]=(0,i.useState)(0),[N,X]=(0,i.useState)(Date.now()-M),[Z,C]=(0,i.useState)([]),[I]=(0,i.useState)(Array.from(Array(7)).map(()=>({ax:c.MathUtils.randFloat(-100,100),ay:c.MathUtils.randFloat(-100,-50),xRadius:c.MathUtils.randFloat(50,300),yRadius:c.MathUtils.randFloat(10,80),numParallel:c.MathUtils.randInt(2,3),rotation:1===c.MathUtils.randInt(0,1)?Math.PI/2:0,spacing:c.MathUtils.randInt(12,35),zTranslate:c.MathUtils.randFloat(-200,200)}))),[Y]=(0,i.useState)(z(I)),[A,F]=(0,i.useState)(new Set),{nodes:R}=(0,x.L)("/Wings/bird.gltf"),{nodes:L}=(0,x.L)("/Wings/perch.gltf"),[O]=(0,i.useState)(R.bird instanceof c.Mesh?R.bird:null),[D]=(0,i.useState)(R.bird001 instanceof c.Mesh?R.bird001:null),[T]=(0,i.useState)(R.bird002 instanceof c.Mesh?R.bird002:null),[U]=(0,i.useState)(L.birdperch instanceof c.Mesh?L.birdperch:null);return(0,i.useEffect)(()=>{let e=l-Z.length;e>0?(Array.from(Array(e)).forEach(()=>{let e=S(A,Y.length);Z.push(new y({pos:new g({x:Y[e].x,y:Y[e].y,z:Y[e].z}),vel:new g({x:c.MathUtils.randFloat(-2,2),y:c.MathUtils.randFloat(-2,2),z:c.MathUtils.randFloat(-2,2)}),bias:0,id:Z.length,action:r.PERCHED,perchDur:c.MathUtils.randFloat(10/3,10),perchedAt:P,perchLoc:[Y[e].x,Y[e].y,Y[e].z,Y[e].w],flapOffset:c.MathUtils.randFloat(0,10)}))}),F(A)):Array.from(Array(-1*e)).forEach(()=>Z.pop()),C(Z)},[l]),(0,i.useEffect)(()=>{let e=Z.filter(e=>e.action!==r.PERCHED);0===e.length&&m(!1)},[Z]),(0,o.A)(e=>{if(E(e.clock.getElapsedTime()),X(Date.now()-M),0===Z.length)return;let a=new Map,r=2*Math.max(s.protectedRange,s.visualRange),n=Z.map(n=>{var i;let l=JSON.stringify(n.getGrid(r));new Set(Array.from(a.keys())).has(l)?null===(i=a.get(l))||void 0===i||i.push(n):a.set(l,[n]);let o=new c.Vector3(n.pos.x,n.pos.y,n.pos.z),h=new c.Vector3(n.perchLoc[0],n.perchLoc[1],n.perchLoc[2]),p=o.distanceTo(h);if(n.setWillPerch(c.MathUtils.randInt(0,100)),p<150&&(P<n.perchedAt+n.perchDur||P>20&&0===n.perchedAt&&n.willPerch())||d){let m=v(p,n,P,N);return m}{let u=w(Z,a,r,n,t,80,s,e.clock.getElapsedTime(),N);return u}});C(n)}),(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)("pointLight",{ref:b,position:[0,.2,4],intensity:.1,color:new c.Color(90,60,0)}),(0,n.jsxs)("mesh",{position:[0,80,0],children:[(0,n.jsx)("boxGeometry",{args:[t[0],t[1],t[2]],ref:j}),(0,n.jsx)("meshStandardMaterial",{color:"gray",opacity:a,transparent:!0,side:c.DoubleSide})]}),Z.map((e,t)=>e.action!==r.PERCHED?(0,n.jsxs)("mesh",{name:e.id.toString(),position:[e.pos.x,e.pos.y,e.pos.z],geometry:null==O?void 0:O.geometry,onUpdate(t){t.lookAt(new c.Vector3(e.pos.x+e.vel.x,e.pos.y+e.vel.y,e.pos.z+e.vel.z))},children:[(0,n.jsx)("mesh",{position:[0,0,-.5],rotation:new c.Euler(0,0,Math.sin((7*P+Math.PI/2)*2+e.flapOffset)),geometry:null==D?void 0:D.geometry,children:(0,n.jsx)("meshStandardMaterial",{color:"blue"})}),(0,n.jsx)("mesh",{position:[0,0,-.5],rotation:new c.Euler(0,0,-Math.sin((7*P+Math.PI/2)*2+e.flapOffset)),geometry:null==T?void 0:T.geometry,children:(0,n.jsx)("meshStandardMaterial",{color:"blue"})}),(0,n.jsx)("meshStandardMaterial",{color:"blue"})]},"fly"+e.id.toString()):(0,n.jsx)("mesh",{position:new c.Vector3(e.perchLoc[0],e.perchLoc[1]-.7,e.perchLoc[2]),rotation:new c.Euler(0,0!==e.perchLoc[3]?(0,h.Z)(e.perchDur)%2==0?Math.PI/2:-Math.PI/2:(0,h.Z)(e.perchDur)%2==0?0:Math.PI,0),geometry:null==U?void 0:U.geometry,children:(0,n.jsx)("meshStandardMaterial",{color:"blue"})},"perch"+e.id.toString())),(0,n.jsx)(p,{points:Y,wires:I})]})},V=(e,t)=>e<t/5,b=(e,t)=>e>t/5&&e<2*t/5,w=(e,t,s,a,n,i,l,o,h)=>{let d=new c.Vector3(a.pos.x,a.pos.y,a.pos.z),p=new g({x:0,y:0,z:0}),m=new g({x:0,y:0,z:0}),u=new g({x:0,y:0,z:0}),x=0;for(let y of a.getNeighbors(s))if(new Set(Array.from(t.keys())).has(y)){for(let f of t.get(y)||[])if(f.id!==a.id){let w=new c.Vector3(f.pos.x,f.pos.y,f.pos.z);d.distanceTo(w)<l.visualRange&&(p.add(f.pos),m.add(f.vel),x+=1),d.distanceTo(w)<l.protectedRange&&u.add(a.pos.diff(f.pos))}}if(x>0){let v=p.div(x).diff(a.pos).prod(l.centering),z=m.div(x).diff(a.vel).prod(l.matching);a.incremVXYZ(v.sum(z))}a.incremVXYZ(u.prod(l.avoid));let j=n[0]/2,S=-1*n[0]/2,M=n[1]/2+i,P=-1*n[1]/2+i,E=n[2]/2,N=-1*n[2]/2;a.pos.x>j&&a.incremVX(-1*l.turnFactor),a.pos.x<S&&a.incremVX(l.turnFactor),a.pos.y>M&&a.incremVY(-1*l.turnFactor),a.pos.y<P&&a.incremVY(l.turnFactor),a.pos.z>E&&a.incremVZ(-1*l.turnFactor),a.pos.z<N&&a.incremVZ(l.turnFactor),V(a.id,e.length)&&(a.vel.x>0?a.setBias(Math.min(l.maxBias,a.bias+l.biasIncrm)):a.setBias(Math.max(l.biasIncrm,a.bias-l.biasIncrm))),b(a.id,e.length)&&(a.vel.x<0?a.setBias(Math.min(l.maxBias,a.bias+l.biasIncrm)):a.setBias(Math.max(l.biasIncrm,a.bias-l.biasIncrm))),V(a.id,e.length)&&a.setVX((1-a.bias)*a.vel.x+a.bias),b(a.id,e.length)&&a.setVX((1-a.bias)*a.vel.x-a.bias);let X=a.getSpeed();return X<l.minSpeed&&(a.setVX(a.vel.x/X*l.minSpeed),a.setVY(a.vel.y/X*l.minSpeed),a.setVZ(a.vel.z/X*l.minSpeed)),X>l.maxSpeed&&(a.setVX(a.vel.x/X*l.maxSpeed),a.setVY(a.vel.y/X*l.maxSpeed),a.setVZ(a.vel.z/X*l.maxSpeed)),a.perchedAt+a.perchDur+10<o&&(a.setPerchedAt(0),a.unsetWillPerch()),a.setAction(r.FLYING),a.move(h),a},v=(e,t,s,a)=>{if(t.action===r.PERCHED)return t;let n=new c.Vector3(t.pos.x,t.pos.y,t.pos.z),i=new c.Vector3(t.perchLoc[0],t.perchLoc[1],t.perchLoc[2]);if(e>1.8){t.incremVX((i.x-n.x)*.01),t.incremVY((i.y-n.y)*.01),t.incremVZ((i.z-n.z)*.01),t.pos.x>t.perchLoc[0]&&(t.incremVX(-.2),t.incremX(-.005)),t.pos.x<t.perchLoc[0]&&(t.incremVX(.2),t.incremX(.005)),t.pos.y>t.perchLoc[1]&&(t.incremVY(-.2),t.incremY(-.005)),t.pos.y<t.perchLoc[1]&&(t.incremVY(.2),t.incremY(.005)),t.pos.z>t.perchLoc[2]&&(t.incremVZ(-.2),t.incremZ(-.005)),t.pos.z<t.perchLoc[2]&&(t.incremVZ(.2),t.incremZ(.005));let l=t.getSpeed();l>2&&(t.setVX(t.vel.x/l*2),t.setVY(t.vel.y/l*2),t.setVZ(t.vel.z/l*2)),e<30&&(t.setVX(.6*t.vel.x),t.setVY(.6*t.vel.y),t.setVZ(.6*t.vel.z)),t.move(a)}else t.setXYZ(i.x,i.y,i.z),t.setVXYZ(0,0,0),t.setAction(r.PERCHED),t.setPerchedAt(s);return t},z=e=>{let t=[];for(let s of e)for(let a=0;a<s.numParallel;a++){let r=new c.EllipseCurve(s.ax,s.ay+2,s.xRadius,s.yRadius,Math.PI+Math.PI/8,0-Math.PI/8,!1,0).getPoints(50).map(e=>new c.Vector3(e.x,e.y,j(a,s)).applyEuler(new c.Euler(0,s.rotation,0))).map(e=>new c.Vector4(e.x,e.y,e.z,s.rotation));t=t.concat(r)}return t},j=(e,t)=>0===e?t.zTranslate:1!==e?t.zTranslate+2*t.spacing:t.spacing%2==0?t.zTranslate+t.spacing:t.zTranslate+t.spacing/2,S=(e,t)=>{let s=c.MathUtils.randInt(0,t-1);return e.has(s)&&t!==e.size?S(e,t):(e.add(s),s)};var M=s(7090),P=s(9365);let E=()=>{let[e,t]=(0,i.useState)([300,180,240]),[s,a]=(0,i.useState)(0),[r,o]=(0,i.useState)(!1),[c,h]=(0,i.useState)(400),[d,p]=(0,i.useState)({turnfactor:.2,visualRange:40,protectedRange:4,centering:5e-4,avoid:.05,matching:.05,maxSpeed:4,minSpeed:2,turnFactor:.2,maxBias:.01,biasIncrm:4e-5});return(0,n.jsxs)("div",{className:"flex flex-row items-center bg-black space-x-4 h-full w-full absolute",children:[(0,n.jsxs)("div",{className:"flex flex-col space-y-4 ml-4 mt-4",children:[(0,n.jsx)(N,{name:"number birds",min:0,max:700,defaultVal:[c],step:1,onValueChange:e=>h(e[0])}),(0,n.jsx)(N,{name:"x boundry",min:30,max:300,defaultVal:[e[0]],step:1,onValueChange:s=>t([s[0],e[1],e[2]])}),(0,n.jsx)(N,{name:"y boundry",min:30,max:300,defaultVal:[e[1]],step:1,onValueChange:s=>t([e[0],s[0],e[2]])}),(0,n.jsx)(N,{name:"z boundry",min:30,max:300,defaultVal:[e[2]],step:1,onValueChange:s=>t([e[0],e[1],s[0]])}),(0,n.jsx)(N,{name:"visual range",min:0,max:60,defaultVal:[d.visualRange],step:1,onValueChange:e=>p({...d,visualRange:e[0]})}),(0,n.jsx)(N,{name:"protected range",min:0,max:20,defaultVal:[d.protectedRange],step:1,onValueChange:e=>p({...d,protectedRange:e[0]})}),(0,n.jsx)(N,{name:"centering factor",min:0,max:.01,defaultVal:[d.centering],step:1e-4,onValueChange:e=>p({...d,centering:e[0]})}),(0,n.jsx)(N,{name:"avoid factor",min:0,max:.1,defaultVal:[d.avoid],step:.001,onValueChange:e=>p({...d,avoid:e[0]})}),(0,n.jsx)(N,{name:"matching factor",min:0,max:.1,defaultVal:[d.matching],step:.001,onValueChange:e=>p({...d,matching:e[0]})}),(0,n.jsx)(N,{name:"turning factor",min:.1,max:.5,defaultVal:[d.turnFactor],step:.001,onValueChange:e=>p({...d,turnFactor:e[0]})}),(0,n.jsx)(N,{name:"speed range",min:1,max:6,defaultVal:[d.minSpeed,d.maxSpeed],step:.1,onValueChange:e=>p({...d,minSpeed:e[0],maxSpeed:e[1]})}),(0,n.jsx)(N,{name:"bias range",min:0,max:.03,defaultVal:[d.biasIncrm,d.maxBias],step:1e-5,onValueChange:e=>p({...d,biasIncrm:e[0],maxBias:e[1]})}),(0,n.jsx)(N,{name:"box opacity",min:0,max:1,defaultVal:[s],step:.01,onValueChange:e=>a(e[0])}),(0,n.jsx)("button",{className:"p-2 bg-green-500 text-white disabled:bg-green-300",disabled:r,onClick:()=>o(!0),children:"Perch all birds"})]}),(0,n.jsx)("div",{className:"w-4/5 h-[700px] bg-black",children:(0,n.jsxs)(l.Xz,{shadows:!0,camera:{fov:75,position:[400,50,-100]},className:"bg-blue-400",children:[(0,n.jsx)(X,{}),(0,n.jsx)(f,{border:e,consts:d,boxOpacity:s,numberBirds:c,allPerching:r,setAllPerching:o})]})})]})},N=e=>{let{min:t,max:s,defaultVal:a,step:r,name:i,onValueChange:l}=e;return(0,n.jsxs)("div",{className:"flex flex-col space-y-1",children:[(0,n.jsx)("span",{className:"text-white select-none",children:i}),(0,n.jsxs)(M.fC,{className:"relative select-none touch-none flex items-center w-[200px] h-2",minStepsBetweenThumbs:1,defaultValue:a,min:t,max:s,onValueCommit:l,step:r,"aria-label":"Volume",children:[(0,n.jsx)(M.fQ,{className:"relative bg-white rounded-full h-2 flex-grow",children:(0,n.jsx)(M.e6,{className:"absolute bg-green-500 rounded-full h-full"})}),a.map(e=>(0,n.jsx)(M.bU,{className:"block w-5 h-5 bg-green-500 rounded-full outline-none "},e))]})]})},X=()=>{let{camera:e,gl:t}=(0,o.z)();return(0,i.useEffect)(()=>{let s=new P.z(e,t.domElement);return s.enableDamping,()=>{s.dispose()}},[e,t]),null};var Z=s(9008),C=s.n(Z);function I(){return(0,n.jsxs)(n.Fragment,{children:[(0,n.jsxs)(C(),{children:[(0,n.jsx)("title",{children:"Create Next App"}),(0,n.jsx)("meta",{name:"description",content:"Generated by create next app"}),(0,n.jsx)("link",{rel:"icon",href:"/Wings/favicon.ico"})]}),(0,n.jsx)(E,{})]})}}},function(e){e.O(0,[737,203,774,888,179],function(){return e(e.s=8312)}),_N_E=e.O()}]);